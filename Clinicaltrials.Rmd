---
title: "virus 2"
output: html_document
date: '2022-06-28'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r include=FALSE}
require(tidyverse)
require(tigerstats)
require(knitr)
newdata<- read.csv(file="clinicalTrial2.csv")
```

```{r eval=FALSE}
newdata <- newdata %>%
mutate(across(where(is.character), as.factor))
```
## Graphical Analysis
```{r}
barchartGC(~infected + vaxStatus,data=newdata)
barchartGC(~infected + vaxStatus,newdata, type="percent")

```

According to the proportion based graph calculated, there is a clear and tangible difference among the percentages of persons who got COVID.  It seems as though, of those who got COVID, over 60% didn't have any vaccine at all.  Conversely, the smallest proportion of persons who contracted the disease had both the first and new doses of the vaccine.  Most potent after that was the new vaccine, then the first one administered.  

## Numerical Summary
```{r}
table1 <- xtabs(~infected + vaxStatus, data=newdata)
rowPerc(table1)
colPerc(table1)
```

The numerical summary generated confirms the illustration presented in the graphical observation.  When looking at the row total of persons who contracted COVID, a solid majority of them (62.7%) had no vaccine at all, while the fewest (5.95%) had both the first and the new vaccine, along with the strongest dose regiments following that being the new and first vaccines, in such order.  

## Inferential Summary

```{r}
chisq.test(table1)
chisqtestGC(table1)
fisher.test(table1, simulate.p.value = TRUE)
```
```{r}
fisherXY = function(x, y, confL = 0, printAll=TRUE){
  # Inputs: 
  #   x: factor variable, 2 levels
  #   y: factor variable, n levels
  # confL: confidence level, default = 0.95
  #        print only those tables, results if p-value < (1-confL)
  # printAll: overide the 'print only if p-value < (1-confL), and
  #           print all tables and fisher test results
  #
  # Constraint:
  #   x and y must be same length
  #
  # Outputs:
  #   All 2x2 Fisher exact tests
  
  if(confL<0 || confL> 1){
    print('error: confL must be between 0 and 1')
    return(999)
  }
  
  if(!is.factor(x)) x=as.factor(x)
  if(!is.factor(y)) y=as.factor(y)
  
  fisherTable = as.matrix(table(x, y))
  cat('\ncontingency table:\n')
  print(fisherTable)
  cat('\n***All 2X2 tests****\n\n')

  # all 2x2 tests
  levelsY = levels(y)
  levelsX = levels(x)
  
  m = length(levelsX)
  n = length(levelsY)
  
  confLevel = 0.95
  if (confL !=0 ) confLevel=confL
  
  for (i in 1:(m-1))
       for(j in ((i+1):m))
          for (k in 1:(n-1))
             for (l in ((k+1):n)) {
                
                 fisherIndexX = c(i,j)
                 fisherIndexY = c(k,l)
                 
                 fTempTable = as.matrix(fisherTable[fisherIndexX,
                                        fisherIndexY])
                 
                 fisherTest=fisher.test(fTempTable, conf.int = TRUE, 
                              conf.level = confLevel)
                 
                 if((fisherTest$p.value < (1-confLevel) ) || printAll){
                   
                       print(c(levelsX[i], levelsX[j]))
                       print(c(levelsY[k], levelsY[l]))
                       print(fTempTable)
                       print(fisherTest)
                       cat('\n')
                 }
                 
        }
}

```
```{r}
fisherXY(newdata$vaxStatus,newdata$infected)
fisherXY = function(x, y, confL = 0, printAll=TRUE){
  # Inputs: 
  #   x: factor variable, 2 levels
  #   y: factor variable, n levels
  # confL: confidence level, default = 0.95
  #        print only those tables, results if p-value < (1-confL)
  # printAll: overide the 'print only if p-value < (1-confL), and
  #           print all tables and fisher test results
  #
  # Constraint:
  #   x and y must be same length
  #
  # Outputs:
  #   All 2x2 Fisher exact tests
  
  if(confL<0 || confL> 1){
    print('error: confL must be between 0 and 1')
    return(999)
  }
  
  if(!is.factor(x)) x=as.factor(x)
  if(!is.factor(y)) y=as.factor(y)
  
  fisherTable = as.matrix(table(x, y))
  cat('\ncontingency table:\n')
  print(fisherTable)
  cat('\n***All 2X2 tests****\n\n')

  # all 2x2 tests
  levelsY = levels(y)
  levelsX = levels(x)
  
  m = length(levelsX)
  n = length(levelsY)
  
  confLevel = 0.95
  if (confL !=0 ) confLevel=confL
  
  for (i in 1:(m-1))
       for(j in ((i+1):m))
          for (k in 1:(n-1))
             for (l in ((k+1):n)) {
                
                 fisherIndexX = c(i,j)
                 fisherIndexY = c(k,l)
                 
                 fTempTable = as.matrix(fisherTable[fisherIndexX,
                                        fisherIndexY])
                 
                 fisherTest=fisher.test(fTempTable, conf.int = TRUE, 
                              conf.level = confLevel)
                 
                 if((fisherTest$p.value < (1-confLevel) ) || printAll){
                   
                       print(c(levelsX[i], levelsX[j]))
                       print(c(levelsY[k], levelsY[l]))
                       print(fTempTable)
                       print(fisherTest)
                       cat('\n')
                 }
                 
        }
}

```
Running the two variable Chi-Square test yielded a p-value less than .05; this, along with the fact that there are more than two categorical variables, necessitates the running of a multi-variable FisherXY test.  


##
## use fisherXY test to determine if the new vaccine is different from
## previous vaccines.

# Data set has 4 categories:
# group with no vaccine
# group with just the old vaccine
# group with both the old and new vaccine
# group with just the new vaccine
#
